---
layout: post
title: Reconocimiento de Entidades
author: Soledad Retamar
published: false
status: process
draft: false
tags: entidades
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Detección de oraciones y palabras
Con estas lineas de código describiremos como detectar oraciones, palabras, personas, lugares y organizaciones en un texto. Para realizarlo mas práctico en este ejemplo analizaremos una noticia extraída y asignaremos el texto en el código, pero se podría aplicar al texto que obtengamos dinamicamente de nuestras fuentes de datos.

Los paquetes necesarios serán: NLP, openNLP y magrittr

```{r}
library(NLP)
library(openNLP)
library(magrittr)

noticia <- as.String('Donald Trump apuntó este martes contra el presidente francés, 
Emmanuel Macron, por su propuesta de crear un ejército europeo, en un nuevo reclamo 
hacia sus aliados europeos para que refuercen su aporte económico hacia el 
financiamiento de la OTAN.
Macron declaró la semana pasada la necesidad de proteger con unas fuerzas armadas 
a Europa,"en relación a China, Rusia e incluso Estados Unidos", una idea que Trump
calificó el viernes como "insultante". Ahora, renovó su rechazo con un mordaz 
comentario, reabriendo heridas entre París y Berlín, hoy estrechos aliados y 
defensores del multilateralismo.
"Fue Alemania en la Primera y Segunda Guerra Mundial. ¿Cómo funcionó eso para Francia?
Ellos estaban comenzando a aprender alemán en París antes de que EEUU intervenga", 
escribió en su Twitter, en referencia a la ocupación nazi sobre la capital francesa, 
entre 1940 y 1944.')

```

## Palabras y Oraciones
Necesitaremos definir dos funciones, basadas en librerías de Java, que nos marcarán donde comienza y termina cada palabra y cada oracion.
```{r}
palabras_ann <- Maxent_Word_Token_Annotator()
oracion_ann <- Maxent_Sent_Token_Annotator()
```
Llamaremos iterativamente a estas funciones para el texto contenido en noticia para determinar primero dónde están las oraciones y luego determinar dónde están las palabras. 
Podemos aplicar estas funciones a nuestros datos utilizando la función annotate().
```{r}
noticia1_annotations <- annotate(noticia, list(oracion_ann, palabras_ann))
```
El objeto creado contiene ahora un objeto que contiene una lista de oraciones y de palabras identificadas por posición. 
```{r, echo=FALSE}
noticia1_annotations[1:8]
```
En nuestro ejemplo, la primera oración en el documento comienza en el caracter 1 y termina en el caracter 250. En el caso de la primer palabra detectada sus posicion inicial es 1 y finaliza en el caracter 6.

Para combinar la noticia y el objeto creado con las posiciones usaremos la función AnnotatedPlainTextDocument del paquete NLP. Si quisiéramos, también podríamos asociar metadatos con el objeto usando el argumento "meta".
```{r}
noti_doc <- AnnotatedPlainTextDocument(noticia, noticia1_annotations)
```

# Palabras y oraciones
Ahora podemos extraer información de nuestro documento utilizando las funciones sents() para obtener las oraciones y words() para obtener las palabras. Mostraremos la primer oración y las primeras 10 palabras:

```{r}
sents(noti_doc) %>% head(1)
words(noti_doc) %>% head(10)
```

# Identificando personas y lugares.
Entre los distintos tipos de anotadores proporcionados por el paquete openNLP se encuentra uno de entidades.
Una entidad es basicamente un nombre propio, como una persona o un nombre de lugar.

Usando una técnica llamada reconocimiento de entidad nombrada (NER), podemos extraer varios tipos de nombres de un documento. 
Crearemos las funciones para detectar tres tipos de entidades: personas, ubicaciones y organizaciones.

```{r}
persona_ann <- Maxent_Entity_Annotator(language ="es", kind = "person")
ubicacion_ann <- Maxent_Entity_Annotator(language ="es", kind = "location")
organizacion_ann <- Maxent_Entity_Annotator(language ="es", kind = "organization")
```

Crearemos una nueva lista para mantener nuestros anotadores en el orden en que queremos aplicarlos

```{r}
annot.l1 = NLP::annotate(noticia, list(oracion_ann, 
                                      palabras_ann,
                                      ubicacion_ann,
                                      persona_ann, 
                                      organizacion_ann))
k <- sapply(annot.l1$features, `[[`, "kind")
```

### Personas que aparecen en la noticia
```{r}
personas = noticia[annot.l1[k == "person"]]
```
Los nombres propios que se encontraron en la noticia son:
```{r, echo=FALSE}
personas
```

### Lugares
```{r}
lugares = noticia[annot.l1[k == "location"]]
```
Si vizualizamos los lugares que detectó en la noticia obtendremos:
```{r, echo=FALSE}
lugares
```

### Organizaciones
```{r}
org = noticia[annot.l1[k == "organization"]]
```

Si vemos las organizaciones:
```{r}
org
```



